databaseChangeLog:
  - preConditions:
    - runningAs:
      username: user

  - changeSet:
    id: 1
      author: Andrey
      changes:

        - createTable:
          tableName: address
          columns:
            - column:
              name: address_id
              type: int4
              autoIncrement: true
              constraints:
                primaryKey: true
                nullable: false
            - column:
              name: customer_fk_id
              type: int4
              constraints:
                nullable:  false
            - column:
              name: country
              type: varchar(255)
            - column:
              name: postal_code
              type: varchar(255)
            - column:
              name: city
              type: varchar(255)
            - column:
              name: address_line
              type: varchar(255)

        - createTable:
          tableName: customer
          columns:
            - column:
              name: customer_id
              type: int4
              autoIncrement: true
              constraints:
                primaryKey: true
                nullable: false
            - column:
              name: first_name
              type: varchar(255)
              constraints:
                nullable: false
            - column:
              name: last_name
              type: varchar(255)
              constraints:
                nullable: false
            - column:
              name: balance
              type: int4
            - column:
              name: phone
              type: varchar(255)
            - column:
              name: email
              type: varchar(255)

        - createTable:
          tableName: order
          columns:
            - column:
              name: order_id
              type: int4
              autoIncrement: true
              constraints:
                primaryKey: true
                nullable: false
            - column:
              name: customer_fk_id
              type: int4
              constraints:
                nullable:  false
            - column:
              name: product_fk_id
              type: int4
              constraints:
                nullable:  false
            - column:
              name: price
              type: decimal(10,2)
            - column:
              name: quantity
              type: int4
              constraints:
                nullable:  false

        - createTable:
          tableName: product
          columns:
            - column:
              name: product_id
              type: int4
              autoIncrement: true
              constraints:
                primaryKey: true
                nullable: false
            - column:
              name: title
              type: varchar(255)
              constraints:
                nullable:  false
            - column:
              name: price
              type: int4
              constraints:
                nullable:  false
            - column:
              name: quantity
              type: int4
              constraints:
                nullable:  false

  - changeSet:
    id: 2
      author: Andrey
      changes:

ALTER TABLE "address" ADD CONSTRAINT "fk_address_customer_1" FOREIGN KEY ("customer_fk_id") REFERENCES "customer" ("customer_id");

  -  addForeignKeyConstraint:
      baseColumnNames:  person_id
      baseTableCatalogName:  cat
      baseTableName: address
      baseTableSchemaName: public
      constraintName: fk_address_customer_1
      deferrable:  true
      initiallyDeferred:  true
      onDelete:  CASCADE
      onUpdate:  RESTRICT
      referencedColumnNames:  id
      referencedTableCatalogName:  cat
      referencedTableName:  person
      referencedTableSchemaName:  public
      validate:  true

  - changeSet:
    id: 3
      author: Andrey
      changes:
        - sqlFile:
          - relativeToChangelogFile: true
          - path: data.sql
